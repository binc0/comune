app.controller("FiltriController",["$scope","FiltriService","GeneralService","RicercaService","$location","$anchorScroll","$sce","$timeout","$q",function(o,a,g,d,f,h,n,c,j){o.contents=[];o.renderContent=[];o.renderContentSecondModel=[];o.calendar=[];o.secondModelId="";o.filters="";o.events=[];o.renderEventContent=[];o.categoryContent=[];o.dayName=[];o.loader=[];o.full=[];o.empty=false;o.argomenti=[];o.ammins_chk=[];o.servizi_chk=[];o.novita_chk=[];o.docs_chk=[];o.ammins_selected=[];o.servizi_selected=[];o.novita_selected=[];o.docs_selected=[];o.args_selected=[];o.categoriaTab="active";o.argomentoTab="";o.opzioniTab="";o.active_chk=null;o.data_inizio=null;o.data_fine=null;o.categorie=[];o.cercatxt="";o.General=g;const e=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];var k=[{contentName:"Pagamento della TARI",category:"Pagamenti"},{contentName:"Pagamento tassa di circolazione",category:"Pagamenti"},{contentName:"Modulo pagamento tasse universitarie",category:"Modulistica"},{contentName:"Pagamento tributi a Pirri",category:"Pagamenti"},{contentName:"Concorso ragioniere - Ufficio pagamenti",category:"Concorsi"},{contentName:"Modulistica pagamento TARSU",category:"Modulistica"}];o.setParameters=function(v,p,w,x,u,r,s,q,t){o.pageSize=parseInt(v);if(u!=""){o.categorie=u}if(p!=""){o.maxElements=parseInt(p)}if(q!=""){o.filters=q}if(s!=undefined){o.secondModelId=s}if(t){o.setContents(t)}else{o.getContents(w,x,u,r)}};o.setCalendarParameters=function(p,s,q){o.oneMonth=true;o.day=p;o.finemese=s;o.days=s-p;for(i=0;i<=o.days;i++){o.calendar[i]=i+parseInt(o.day);o.full[o.calendar[i]]=true}if(o.days<=9){o.oneMonth=false;var r=new Date();o.nextMonth=e[r.getMonth()+1];o.daysOld=angular.copy(o.days)+1;o.day=1;o.finemese=10-o.days;o.days=o.finemese-o.day;for(i=0;i<=o.days;i++){o.calendar[i+o.daysOld]=i+parseInt(o.day);o.full[o.calendar[i+o.daysOld]]=true}}};o.getContents=function(v,u,t,s,r,p){o.countEmpty=0;if(r!=undefined){o.filters=r}if(o.searchParameters){for(var q in o.searchParameters){if(o.searchParameters[q]!=null){if(q.indexOf("dat")>=0){if(o.filters==""){o.filters+="(attributeFilter=true;key="+q+";value="+o.searchParameters[q].start+";end="+o.searchParameters[q].end+";)"}else{o.filters+="+(attributeFilter=true;key="+q+";start="+o.searchParameters[q].start+";end="+o.searchParameters[q].end+";)"}}else{if(o.filters==""){o.filters+="(attributeFilter=true;key="+q+";value="+o.searchParameters[q]+";likeOption=true;)"}else{o.filters+="+(attributeFilter=true;key="+q+";value="+o.searchParameters[q]+";likeOption=true;)"}}}}}o.currentPage=0;o.pages=[];if(s){b(s,o.oldElem);o.oldElem=s}a.getContents(v,t,o.filters,p).then(function(w){o.events[p]=[];if(w==undefined){o.full[p]=false;o.countEmpty=o.countEmpty+1}if(w!=undefined){o.loader[p]=true;if(!Array.isArray(w)){if(w.$){o.contents=[];o.contents[0]=w;o.events[p].push(w)}}else{if(o.maxElements>=w.length){o.contents=w;o.events[p]=w}else{for(x=0;x<o.maxElements;x++){o.contents[x]=w[x];o.events[p]=w[x]}}}o.numberOfPages=Math.ceil(o.contents.length/o.pageSize);for(x=0;x<o.numberOfPages;x++){o.pages[x]=x+1}for(var x in o.contents){a.getContent(o.contents[x].$,u,x).then(function(y){o.renderContent[y.item.id]=n.trustAsHtml(m(y.html))},function(y){console.error("Errore durante il caricamento del contenuto")})}if(o.secondModelId!=""){for(var x in o.contents){a.getContent(o.contents[x].$,o.secondModelId).then(function(y){o.renderContentSecondModel[y.item.id]=n.trustAsHtml(m(y.html))},function(y){console.error("Errore durante il caricamento del contenuto")})}}if(p!=undefined){o.renderEventContent[p]=[];o.categoryContent[p]=[];for(var x in o.events[p]){a.getContent(o.events[p][x].$,u).then(function(y){o.renderEventContent[p][y.item.id]=n.trustAsHtml(y.html);o.loader[p]=false;o.categoryContent[p][y.item.id]="";for(var z in y.item.categories.category){if(y.item.categories.category[z]!=undefined){o.categoryContent[p][y.item.id]+=y.item.categories.category[z]}}},function(y){o.loader[p]=false;console.error("Errore durante il caricamento del contenuto")})}}}else{o.contents=[]}if(o.countEmpty!=o.calendar.length&&v=="EVN"){c(l,1000)}else{o.empty=true}},function(w){o.contents=[];o.loader[p]=false})};o.getContent=function(p,q){a.getContent(o.contents[p].$,q).then(function(r){o.renderContentSecondModel[r.item.id]=n.trustAsHtml(m(r.html))},function(r){console.error("Errore durante il caricamento del contenuto")})};function m(r){var p,t,s;p=window.navigator.userAgent;t=/msie|Trident.*rv[ :]*11\./gi;s=t.test(p);if(s){var q=$(r);var u=q.find("img").prop("src");if(u){q.find(".img-fit-cover").css("backgroundImage","url("+u+")").addClass("img-fit-ie")}return q.prop("outerHTML")}else{return r}}function b(q,p){if(p){var s=document.getElementById(p);$(s).removeClass("active")}if(q!=""){var r=document.getElementById(q);$(r).addClass("active")}}o.goToPage=function(p){o.currentPage=p};o.goToFirstPage=function(){o.currentPage=0};o.refreshPage=function(){o.currentPage=1;c(o.goToFirstPage,1000)};o.getFilterDay=function(p,t,r){var s=parseInt(t)-1;var q=new Date(r,s,p);o.dayName[p]=q.toLocaleString(undefined,{weekday:"short"});return"(attributeFilter=true;key=data_iniz;start="+p+"/"+t+"/"+r+";end="+p+"/"+t+"/"+r+")"};o.setContents=function(q){o.contents=q.replace(/=/g,'":"');o.contents=o.contents.replace(/}/g,'"}');o.contents=o.contents.replace(/contentId/g,'"contentId').replace(/modelId/g,'"modelId');o.contents=o.contents.replace(/, "/g,'", "');o.contents=JSON.parse(o.contents);if(o.pageSize!=0){o.numberOfPages=Math.ceil(o.contents.length/o.pageSize)}else{o.numberOfPages=1}o.pages=[];o.currentPage=0;for(p=0;p<o.numberOfPages;p++){o.pages[p]=p+1}for(var p in o.contents){a.getContent(o.contents[p].contentId,o.contents[p].modelId).then(function(r){o.renderContent[r.item.id]=n.trustAsHtml(r.html)},function(r){console.error("Errore durante il caricamento del contenuto")})}};function l(){var p=$("#owl-calendario");p.owlCarousel({nav:false,startPosition:0,autoPlay:false,responsiveClass:true,responsive:{0:{items:1,},576:{items:2,},768:{items:3,},991:{items:4,},}})}o.setArgomenti=function(q,p){if(q!="Argomenti"){o.argomenti.push({name:q.replace("%","'"),code:p})}};o.setCategorie=function(q,p){switch(p){case"Amministrazione":ammins_chk.push(q);break;case"NovitÃ ":novita_chk.push(q);break;case"Servizi":servizi_chk.push(q);break;case"Documenti e dati":docs_chk.push(q);break}};o.getArgomentiList=function(){var q="";if(o.categorie){q=o.categorie}for(var p in o.args_selected){if(q==""){q+=o.args_selected[p].code+""}else{q+=","+o.args_selected[p].code}}for(var p in o.ammins_selected){if(q==""){q+=o.ammins_selected[p].code+""}else{q+=","+o.ammins_selected[p].code}}for(var p in o.servizi_selected){if(q==""){q+=o.servizi_selected[p].code+""}else{q+=","+o.servizi_selected[p].code}}for(var p in o.novita_selected){if(q==""){q+=o.novita_selected[p].code+""}else{q+=","+o.novita_selected[p].code}}for(var p in o.docs_selected){if(q==""){q+=o.docs_selected[p].code+""}else{q+=","+o.docs_selected[p].code}}return q};o.cleanSearchParameter=function(p){if(p=="all"){o.searchParameters={}}else{delete o.searchParameters[p]}};o.toggle=function(q,r){var p=r.indexOf(q);if(p>-1){r.splice(p,1);b("",q.code)}else{r.push(q);b(q.code)}};o.exists=function(p,q){return q.indexOf(p)>-1};o.ammins_isIndeterminate=function(){return(o.ammins_selected.length!==0&&o.ammins_selected.length!==o.ammins_chk.length)};o.ammins_isChecked=function(){return o.ammins_selected.length===o.ammins_chk.length};o.ammins_toggleAll=function(){if(o.ammins_selected.length===o.ammins_chk.length){o.ammins_selected=[]}else{if(o.ammins_selected.length===0||o.ammins_selected.length>0){o.ammins_selected=o.ammins_chk.slice(0)}}};o.servizi_isIndeterminate=function(){return(o.servizi_selected.length!==0&&o.servizi_selected.length!==o.servizi_chk.length)};o.servizi_isChecked=function(){return o.servizi_selected.length===o.servizi_chk.length};o.servizi_toggleAll=function(){if(o.servizi_selected.length===o.servizi_chk.length){o.servizi_selected=[]}else{if(o.servizi_selected.length===0||o.servizi_selected.length>0){o.servizi_selected=o.servizi_chk.slice(0)}}};o.novita_isIndeterminate=function(){return(o.novita_selected.length!==0&&o.novita_selected.length!==o.novita_chk.length)};o.novita_isChecked=function(){return o.novita_selected.length===o.novita_chk.length};o.novita_toggleAll=function(){if(o.novita_selected.length===o.novita_chk.length){o.novita_selected=[]}else{if(o.novita_selected.length===0||o.novita_selected.length>0){o.novita_selected=o.novita_chk.slice(0)}}};o.docs_isIndeterminate=function(){return(o.docs_selected.length!==0&&o.docs_selected.length!==o.docs_chk.length)};o.docs_isChecked=function(){return o.docs_selected.length===o.docs_chk.length};o.docs_toggleAll=function(){if(o.docs_selected.length===o.docs_chk.length){o.docs_selected=[]}else{if(o.docs_selected.length===0||o.docs_selected.length>0){o.docs_selected=o.docs_chk.slice(0)}}};o.toggleAll=function(p){if(p=="categorie"){o.ammins_selected=[];o.servizi_selected=[];o.novita_selected=[];o.docs_selected=[]}if(p=="argomenti"){o.args_selected=[]}switch(p){case"categorie":o.ammins_selected=[];o.servizi_selected=[];o.novita_selected=[];o.docs_selected=[];break;case"argomenti":o.args_selected=[];break;default:o.ammins_selected=[];o.servizi_selected=[];o.novita_selected=[];o.docs_selected=[];o.args_selected=[];o.active_chk=null;o.clean_date()}};o.class_tutti=function(p){o.searchParametersLength=0;if(o.searchParameters){o.searchParametersLength=Object.keys(o.searchParameters).length}switch(p){case"categorie":if(o.ammins_selected.length!==0||o.servizi_selected.length!==0||o.novita_selected.length!==0||o.docs_selected.length!==0||o.searchParametersLength!==0||o.searchParameters!==undefined){return""}else{return"active"}break;default:if(o.ammins_selected.length!==0||o.servizi_selected.length!==0||o.novita_selected.length!==0||o.docs_selected.length!==0||o.args_selected.length!==0||o.active_chk!=null||o.data_inizio!=null||o.data_fine!=null||o.searchParametersLength!==0){return""}else{return"active"}break}};o.class_categorie=function(p,q){if(p.length!==0&&p.length!==q.length){return"active"}else{if(p.length===q.length){return"active"}else{return""}}};o.unchk=function(q,r){var p=r.indexOf(q);if(p>-1){r.splice(p,1)}};o.clean_date=function(){o.data_inizio=null;o.data_fine=null};o.setActive=function(p){switch(p){case"argomenti":o.categoriaTab="";o.argomentoTab="active";o.opzioniTab="";break;case"opzioni":o.categoriaTab="";o.argomentoTab="";o.opzioniTab="active";break;default:o.categoriaTab="active";o.argomentoTab="";o.opzioniTab=""}};o.setArgsSelected=function(p){if(p!=""){o.args_selected=p.split(",")}};o.setCatSelected=function(p,q){if(q!=""){switch(p){case"amministrazione":o.ammins_selected=q.split(",");break;case"servizi":o.servizi_selected=q.split(",");break;case"novita":o.novita_selected=q.split(",");break;case"documenti":o.docs_selected=q.split(",");break;default:}}};o.getRisultatiRicerca=function(q){var p=j.defer();p.resolve(k);return p.promise};o.selectedRicercaTxtItemChanged=function(p){if(p!==undefined&&p.contentName!==undefined){cercatxt=p.contentName}if(p===undefined){cercatxt=""}}}]);app.filter("startFrom",function(){return function(a,b){b=+b;return a.slice(b)}});